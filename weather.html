<!DOCTYPE html>

<html>
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>rrms</title>
    <script src="script.js"></script>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css" rel="stylesheet"/>
</head>
<body>
  <nav class="navigation-position">
        <div class="navigation-container" id="navigation">
            
            <div class="navigation-head">
                <img src="riskreduction.png" alt="logo" class="clickers-logo">
                
                <div class="button-head">
                  <a href=""><button class="button-report">Report</button></a>
                    <a href="dashboard.html"><button class="button-dashboard">Dashboard</button></a>
                </div>
                
                   <div onclick="baranimation(this)">
                     <div class="span-bar" onclick="openmenu()">
                       <div class="bar-right"></div>
                       <div class="bar-short"></div>
                       <div class="bar-left"></div>
                     </div>
                   </div>
            </div>
            
            <ul>
                <p class="text-head">Explore</p>
              <li><a href="map.html"><i class="ri-map-pin-2-line icon-menu"></i>Map</a></li>
              <li><a href=""><i class="ri-thunderstorms-line icon-menu"></i>Weather update</a></li>
              <li><a href=""><i class="ri-rainy-line icon-menu"></i>Rain Drop</a></li>
              <li><a href=""><i class="ri-road-map-line icon-menu"></i>Route</a></li>
                <p class="text-head">USER MANAGEMENT</p>
              <li><a href=""><i class="ri-group-line icon-menu"></i>Create Account</a></li> 
              <li><a href=""><i class="ri-settings-3-line icon-menu"></i>Settings</a></li>                
              <li><a href="index.html"><i class="ri-arrow-left-line icon-menu"></i>Log out</a></li>
            </ul>
            
        </div>
    </nav>
  
  <div class="weather-container">
    
    <div class="location-date-container">
      <div class="location">
        <i class="ri-map-pin-line location-icon"></i>
        <h2 class="location-text">-----</h2>
      </div>
      <h2 class="today-date">-----</h2>
    </div>
    <audio src="audioalert.mp3"  autoplay></audio>
    
    <div class="location-date-container">
      <image src="weather.png" class="weather-image">
        <div class="temperature-container">
          <h2 class="temperature-celcius">-----</h2>
          <p class="text-feels-like">Feels like</p><h2 class="feels-like-temp"></h2>
          <h2 class="temperature-heavy">-----</h2>
        </div>
    </div>
    
    <div class="location-date-container">
      <div class="drop-water">
        <i class="ri-contrast-drop-2-line drop-icon"></i>
        <div class="humidity-container">
         <h2 class="humidity-text">Humidity</h2>
         <h2 class="humidity-percent">-----</h2>
        </div>
      </div>
      <div class="wind-container">
        <i class="ri-windy-line wind-icon"></i>
        <div class="wind-average">
          <h2 class="wind-text">Wind Speed</h2>
          <h2 class="wind-percent">-----</h2>
        </div>
      </div>
    </div>
      
      <div class="weather-week-container">
        <div class="weather-week">
          <h2 class="week-day">14 Mar</h2>
          <img src="weather.png" class="weather-week-image">
          <h2 class="week-celcius">32 ℃</h2>
        </div>
        
       
        
        <div class="weather-week">
          <h2 class="week-day">14 Mar</h2>
          <img src="weather.png" class="weather-week-image">
          <h2 class="week-celcius">32 ℃</h2>
        </div>
        
        <div class="weather-week">
          <h2 class="week-day">14 Mar</h2>
          <img src="weather.png" class="weather-week-image">
          <h2 class="week-celcius">32 ℃</h2>
        </div>
        
        <div class="weather-week">
          <h2 class="week-day">14 Mar</h2>
          <img src="weather.png" class="weather-week-image">
          <h2 class="week-celcius">32 ℃</h2>
        </div>
        
        <div class="weather-week">
          <h2 class="week-day">14 Mar</h2>
          <img src="weather.png" class="weather-week-image">
          <h2 class="week-celcius">32 ℃</h2>
        </div>
      </div>
      
    </div>
    
    <div class="alert-container" id="error-message-weather">
      <img src="shield.gif" class="alert-construct">
      <p class="alert-text">No internet connection!</p>
    </div>
    
    <form>
      <div class="alert-heat-container" id="medium-alert-heat">
       <h2 class="heading-heat-alert" id="medium-heat">Medium Heat Risk!</h2>
        <p class="text-feels-like">Feels like</p><h2 class="feels-like-temp2"></h2>
        <p class="text-description">Mainit na panahon, maaaring magdulot ng discomfort.</p>
       <div class="button-medium-alert">
         <div class="buttonalert" onclick="stopAlertSound()"><div class="button-medium-alert-cancel" onclick="mediumriskcancel1()">Cancel</div></div><button class="button-medium-alert-send">Send</button>
       </div>
      </div>
    </form>
      
      <form>
       <div class="alert-heat-container" id="high-alert-heat">
        <h2 class="heading-heat-alert" id="high-heat">High Heat Risk!</h2>
         <p class="text-feels-like">Feels like</p><h2 class="feels-like-temp3"></h2>
         <p class="text-description">Matinding init, maaaring magdulot ng dehydration o heat exhaustion.</p>
        <div class="button-medium-alert">
          <div class="buttonalert" onclick="stopAlertSound()">
         <div class="button-medium-alert-cancel" onclick="mediumriskcancel2()">Cancel</div><button class="button-medium-alert-send">Send</button>
          </div>
        </div>
       </div>
      </form>
    
      <form>
       <div class="alert-heat-container" id="Severe-alert-heat">
        <h2 class="heading-heat-alert" id="severe-heat">Severe Heat Risk!</h2>
         <p class="text-feels-like">Feels like</p><h2 class="feels-like-temp4"></h2>
         <p class="text-description">Napakatinding init, mataas ang panganib ng heatstroke.</p>
        <div class="button-medium-alert">
          <div class="buttonalert" onclick="stopAlertSound()">
         <div class="button-medium-alert-cancel" onclick="mediumriskcancel()">Cancel</div><button class="button-medium-alert-send">Send</button>
          </div>
        </div>
       </div>
      </form>
    
      <form>
       <div class="alert-heat-container" id="wind-moderate-risk">
        <h2 class="heading-heat-alert" id="moderate-wind">Moderate Wind Risk!</h2>
         <p class="text-feels-like">Wind</p><h2 class="wind-average"></h2>
         <p class="text-description">Posibleng paglipad ng magaan na bagay, maliit na sanga, at debris.</p>
        <div class="button-medium-alert">
          <div class="buttonalert" onclick="stopAlertSound()">
         <div class="button-medium-alert-cancel" id="button-medium-alert-cancel" onclick="mediumriskcancel3()">Nakahanda</div>
          </div>
        </div>
       </div>
      </form>
    
    <script>
    let openlink = document.getElementById("navigation")
        openlink.style.maxHeight = "50px";
    </script>
    
    <script>
 let apiKey = "34a74245af5e230b5aad3bcaf20e6ecc"; 

let countryTxt = document.querySelector(".location-text");
let tempTxt = document.querySelector(".temperature-celcius");
let feelsLikeTxt = document.querySelector(".feels-like-temp");
let feelsLikeTxt2 = document.querySelector(".feels-like-temp2");
let feelsLikeTxt3 = document.querySelector(".feels-like-temp3");
let feelsLikeTxt4 = document.querySelector(".feels-like-temp4");
let conditionTxt = document.querySelector(".temperature-heavy");
let humidityValueTxt = document.querySelector(".humidity-percent");
let windValueTxt = document.querySelector(".wind-percent");
let windValueTxt2 = document.querySelector(".wind-average");
let weatherSummaryimg = document.querySelector(".weather-image");
let currentDateTxt = document.querySelector(".today-date");
let weatherAlert = document.getElementById("error-message-weather");

let forecastItemsContainer = document.querySelector(".weather-week-container");

async function getFetchData(city) {
  let apiUrl = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`;

  try {
    const response = await fetch(apiUrl);
    if (!response.ok) throw new Error("Weather data not found.");
    return await response.json();
  } catch (error) {
    console.error("Error fetching weather data:", error);
    return null;
  }
}

async function getForecastData(city) {
  let apiUrl = `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=metric`;

  try {
    const response = await fetch(apiUrl);
    if (!response.ok) throw new Error("Forecast data not found.");
    return await response.json();
  } catch (error) {
    console.error("Error fetching forecast data:", error);
    return null;
  }
}

function getWeatherIcon(id) {
  if (id === 232) return "thunderstorm.png";
  if (id === 321) return "drizzle.png";
  if (id === 531) return "rain.png";
  if (id === 781) return "atmosphere.png";
  if (id === 800) return "clear.png";
  return "weather.png";
}
    
function playAlertSound() {
    let audio = new Audio("audioalert.mp3");
    audio.loop = true;
    audio.play();
}
    
function stopAlertSound() {
    alertAudio.pause();
    alertAudio.currentTime = 0;
}

async function updateWeatherInfo(city) {
  let weatherData = await getFetchData(city);

  let alertnotif2 = document.getElementById("error-message-weather");

  if (!weatherData) {
    alertnotif2.classList.add("open-alert");
    return;
  } else {
    alertnotif2.classList.remove("open-alert");
  }
  
  

  let {
    name: country,
    main: { temp, feels_like, humidity },
    weather: [{ id, main }],
    wind: { speed },
  } = weatherData;

  countryTxt.textContent = country;
  tempTxt.textContent = Math.round(temp) + " ℃";
  feelsLikeTxt.textContent = Math.round(feels_like) + " ℃";
  feelsLikeTxt2.textContent = Math.round(feels_like) + " ℃";
  feelsLikeTxt3.textContent = Math.round(feels_like) + " ℃";
  feelsLikeTxt4.textContent = Math.round(feels_like) + " ℃";
  conditionTxt.textContent = main;
  humidityValueTxt.textContent = humidity + " %";
  windValueTxt.textContent = Math.round(speed * 3.6) + " Km/h";
  windValueTxt2.textContent = Math.round(speed * 3.6) + " Km/h";
  currentDateTxt.textContent = getCurrentDate();

  weatherSummaryimg.src = getWeatherIcon(id);
  
  let MediumAlertHeat = document.getElementById("medium-alert-heat");
  let HighAlertHeat   = document.getElementById("high-alert-heat");
  let SevereAlertHeat = document.getElementById("Severe-alert-heat");
  let ModerateAlertWind = document.getElementById("wind-moderate-risk");
  
      if (feels_like >= 20 && feels_like <= 35) {
       MediumAlertHeat.classList.add("show-alert-medium");
        playAlertSound();
      }
      if (feels_like >= 36 && feels_like <= 40) {
       HighAlertHeat.classList.add("show-alert-medium");
        playAlertSound();
      }
      if (feels_like >= 41) {
       SevereAlertHeat.classList.add("show-alert-medium");
        playAlertSound();
      }
        
      if (speed >= 8.66 && speed <= 16.66) {
        ModerateAlertWind.classList.add("show-alert-medium");
        playAlertSound();
      }
 
}

    let MediumAlertHeat = document.getElementById("medium-alert-heat");
    let HighAlertHeat   = document.getElementById("high-alert-heat");
    let SevereAlertHeat = document.getElementById("Severe-alert-heat");
    
    let ModerateAlertWind = document.getElementById("wind-moderate-risk");
    
    function mediumriskcancel1() {
      MediumAlertHeat.classList.remove("show-alert-medium");
    }
    function mediumriskcancel2() {
      HighAlertHeat.classList.remove("show-alert-medium");
    }
    function mediumriskcancel() {
      SevereAlertHeat.classList.remove("show-alert-medium");
    }
    
    function mediumriskcancel3() {
      ModerateAlertWind.classList.remove("show-alert-medium");
    }

async function updateForecast(city) {
  let forecastData = await getForecastData(city);

  if (!forecastData) return;

  forecastItemsContainer.innerHTML = "";

  let dailyForecast = {};
  forecastData.list.forEach((item) => {
    let date = item.dt_txt.split(" ")[0];
    if (!dailyForecast[date]) {
      dailyForecast[date] = item;
    }
  });

  Object.values(dailyForecast).forEach((item) => {
    const {
      dt_txt: date,
      weather: [{ id }],
      main: { temp },
      wind: { speed },
    } = item;

    const forecastItem = `
      <div class="weather-week">
        <h2 class="week-day">${new Date(date).toLocaleDateString("en-GB", { day: "2-digit", month: "short" })}</h2>
        <img src="${getWeatherIcon(id)}" class="weather-week-image">
        <h2 class="week-celcius">${Math.round(temp)} ℃</h2>
      </div>
    `;
     
    forecastItemsContainer.insertAdjacentHTML("beforeend", forecastItem);
  });
}

function getCurrentDate() {
  let currentDate = new Date();
  let dateOptions = { weekday: "short", day: "2-digit", month: "short" };
  return currentDate.toLocaleDateString("en-GB", dateOptions);
}

setInterval(() => {
  updateWeatherInfo("Poblacion North,PH");
  updateForecast("Poblacion North,PH");
}, 60000);

updateWeatherInfo("Poblacion North, Ph");
updateForecast("Poblacion North, Ph");

    </script>
</body>
</html>
